<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="css/management_z.css">
    <title>管理列表</title>
</head>
<body>
    <div class="header">
        <div class="head_title">
            <div class="return" onclick="history.go(-1)"><img src="images/list/on_left.png" alt=""></div>
            <div class="hetitle">社区管家</div>
        </div>
        <div class="header_nav">
            <div class="header_btn active admin_list" data-class="administration">管理列表<div class="header_red"></div></div>
            <div class="header_btn newsCenter" data-class="news">消息中心<div class="header_red" id="number"></div></div>
        </div>
    </div>
    <div class="content">
        <div class="cont_list administration" style="display: block;">
            <div class="cont_list0">
                
            </div>
            <!--<div style="height: 110px;"></div>&lt;!&ndash;占位&ndash;&gt;-->
            <div class="cont_add" onclick="btnhref();"><span>+</span>添加新房产认证</div>
        </div>
        <div class="cont_list news" >
        </div>
    </div>
    <div class="Mask" style="display: none;"></div>
    <div class="pop_up In_audit" style="display: none;" id="In_audit1"> </div>
    
    <div class="pop_up upload" id="upload">
    </div>
    <div class="pop_up success" id="success">
    </div>
    <!--审核未通过-->
    <div class="pop_up fail" id="fail">
        <div class="pop_top">
            <img src="images/list/fail.png" alt="">
            员工审核未通过
        </div>
        <div class="pop_time">
            2019.12.23 15:30:23
        </div>
        <div class="pop_text">
            您所提交的【门店名称字段】员工申请【人员姓名 130102199105210310】未能通过审核，请悉知
        </div>
        <div class="poptime">
            首次提报时间：2019.12.12 15:30:22
        </div>
        <div class="pop_feedback">
            <div class="feedback_title">管理员反馈：</div>
            <div class="feedback">
                信息管理员反馈信息管理员反馈信息管理员反馈信息管理员反馈信息管理员反馈信息管理员反馈信息管理员反馈信息管理员反馈信息管理员反馈信息管理员反馈信息管理员反馈信息管理员反馈信息管理员反馈信息</div>
        </div>
        <div class="pop_btn"><a href="personnel_y.html">查看</a></div>
    </div>
    <!--过期-->
   <div class="pop_up end" id="end1">
    </div>
    
</body>
<script src="js/jquery-3.3.1.min.js"></script>
<script>
    $(function () {
        $('.header .header_btn').click(function () {
            $('.cont_list').fadeOut(0)
            var tclass = $(this).data('class');
            $(this).addClass('active').siblings('.header_btn').removeClass('active');
            $('.'+tclass).fadeIn(0);
        })
        $('.cont_list .result').click(function () {
            $('.pop_up').fadeOut(200);
            var thatclass = $(this).data('class');
            $('.Mask').fadeIn(200);
            $('.pop_up.'+thatclass).fadeIn(200);
        })
        $('.Mask').click(function () {
            $(this).fadeOut(200);
            $('.pop_up').fadeOut(200);
        })
        //请求数据
        $.ajax({
            //请求方式
            type:'POST',
            //发送请求的地址
            url:'/jianfuzengxiao/api/personnel/getHousesList.html',
            //服务器返回的数据类型
            dataType:'json',
            //发送到服务器的数据，对象必须为key/value的格式，jquery会自动转换为字符串格式
            data:{
                userId:3
            },
            success:function(data){
              console.log(data.data)
              var html='';
              var img='';
              for(var i=0;i<data.data.length;i++){
                    // console.log(data.data[i].housesStatus)
                    // 1为房屋2为门店
                    if(data.data[i].housesStatus ==1){
                        img = '<img src="images/list/icon_01.png" alt="">'
                        var title_time = '<div class="title_time">'+data.data[i].storiedBuildingNumber+'-'+data.data[i].unit+'-'+data.data[i].houseNumber+'</div>'
                    }else if(data.data[i].housesStatus == 2){
                        img = '<img src="images/list/icon_02.png" alt="">'
                        var title_time = '<div class="title_time">'+data.data[i].houseNumber+'号</div>'
                    }
                    html += '<a class="address" href="house_z.html?housesId='+data.data[i].housesId+'">'+
                                '<div class="cont">'+
                                    '<div class="cont_title">'
                                    +img+
                                        '<div class="title_text">'+data.data[i].communityStreetName+'</div>'
                                        +title_time+
                                    '</div>'+
                                    '<div class="address">'+data.data[i].provName+''+data.data[i].cityName+''+data.data[i].areaName+''+data.data[i].communityName+''+data.data[i].communityStreetName+''+data.data[i].housesAddress+'</div>'+
                                '</div>'+
                                '</a>';
                }
                 $('.cont_list0').html(html);
                 $('.admin_list .header_red').html(data.data.length)
              
            },
            error:function(jqXHR){
            }
        });
        
        
        // 消息中心
        $.ajax({
        	 //请求方式
            type:'POST',
            //发送请求的地址
            url:'/jianfuzengxiao/api/msgInfo/getMsgInfoPage.html',
            //服务器返回的数据类型
            dataType:'json',
            //发送到服务器的数据，对象必须为key/value的格式，jquery会自动转换为字符串格式
            data:{
                userId:3
            },
            success:function(data){
            	console.log(data.data)
            	console.log(data.data.rows)
            	var pro='';//审核通过
            	for(var i=0;i<data.data.rows.length;i++){
            		if(data.data.rows[i].msgTypeId=='4')
            		{
                        pro +='<div class="result" data-class="success" onclick="showtime('+data.data.rows[i].msgId+','+data.data.rows[i].personnelId+')">'+
                        '<div class="result_red" style="display: block">'+
                        '</div>'+
                        '<div class="result_title">'+
                        '<div class="rtitle_left">'+
                        '<img src="images/list/success.png" alt="">'+
                        '<div class="result_text">'+data.data.rows[i].title+'</div>'
                        +'</div>'+
                        '<div class="result_time">'+data.data.rows[i].createTime+'</div>'+
                        '</div>'+
                        '<div class="result_cont">'+data.data.rows[i].content+'</div>'+
                        '</div>'
            		}else if(data.data.rows[i].msgTypeId == '3'){
            		  pro+= '<div class="result fail" data-class="fail" onclick="showtime('+data.data.rows[i].msgId+','+data.data.rows[i].personnelId+')">'+
            		  '<div class="result_red">'+
            		  '</div>'+'<div class="result_title">'+
            		  '<div class="rtitle_left">'+
            		  '<img src="images/list/fail.png" alt="">'+
            		  '<div class="result_text">'+data.data.rows[i].title+'</div>'+
            		  '</div>'+
            		  '<div class="result_time">'+data.data.rows[i].createTime+'</div>'+
            		  '</div>'+'<div class="result_cont">'+data.data.rows[i].content+'</div>'+
                        '</div>'
            			
            		}else if(data.data.rows[i].msgTypeId == "2"){
            			  pro+= '<div class="result end" data-class="end" onclick="showtime('+data.data.rows[i].msgId+','+data.data.rows[i].personnelId+')">'+
                		  '<div class="result_red">'+
                		  '</div>'+'<div class="result_title">'+
                		  '<div class="rtitle_left">'+
                		  '<img src="images/list/end.png" alt="">'+
                		  '<div class="result_text">'+data.data.rows[i].title+'</div>'+
                		  '</div>'+
                		  '<div class="result_time">'+data.data.rows[i].createTime+'</div>'+
                		  '</div>'+'<div class="result_cont">'+data.data.rows[i].content+'</div>'+
                      '</div>'
            		}else if(data.data.rows[i].msgTypeId == '1'){
            			 pro+= '<div class="result" data-class="In_audit" onclick="showtime('+data.data.rows[i].msgId+','+data.data.rows[i].personnelId+')">'+
               		  '<div class="result_red">'+
               		  '</div>'+'<div class="result_title">'+
               		  '<div class="rtitle_left">'+
               		  '<img src="images/list/In_audit.png" alt="">'+
               		  '<div class="result_text">'+data.data.rows[i].title+'</div>'+
               		  '</div>'+
               		  '<div class="result_time">'+data.data.rows[i].createTime+'</div>'+
               		  '</div>'+'<div class="result_cont">'+data.data.rows[i].content+'</div>'+
                     '</div>'
            		}else if(data.data.rows[i].msgTypeId == '5'){
            			 pro+= '<div class="result" data-class="upload" onclick="showtime('+data.data.rows[i].msgId+','+data.data.rows[i].personnelId+')">'+
                  		  '<div class="result_red">'+
                  		  '</div>'+'<div class="result_title">'+
                  		  '<div class="rtitle_left">'+
                  		  '<img src="images/list/In_audit.png" alt="">'+
                  		  '<div class="result_text">'+data.data.rows[i].title+'</div>'+
                  		  '</div>'+
                  		  '<div class="result_time">'+data.data.rows[i].createTime+'</div>'+
                  		  '</div>'+'<div class="result_cont">'+data.data.rows[i].content+'</div>'+
                        '</div>'
            		}
                }
            	$('.news').html(pro);
                for(var i=0;i<data.data.rows.length;i++){
                    if(data.data.rows[i].status == 1){
                        $('.news .result').eq(i).find('.result_red').fadeIn(0);
                    }else if(data.data.rows[i].status == 2){
                        $('.news .result').eq(i).find('.result_red').fadeOut(0);
                    }
                }
            	$('#number').html(data.data.rows.length)
            	
            },
            error:function(jqXHR){
            	
            }
        	
        });
    })
    
        function showtime(id,personnelId){
    	   console.log(id)
    	   console.log(personnelId)
    
        var msgId=id
      
        //请求数据
        $.ajax({
            //请求方式
            type:'POST',
            //发送请求的地址
            url:'/jianfuzengxiao/api/msgInfo/getMsgDetail.html ',
            //服务器返回的数据类型
            dataType:'json',
            //发送到服务器的数据，对象必须为key/value的格式，jquery会自动转换为字符串格式
            data:{
                msgId:msgId
            },
            success:function(data){
              console.log(data.data)
              var selehtml='';
              if(data.data.msgTypeId!='3'){
            	    selehtml+='<div class="pop_top"><img src="images/list/success.png" alt="">'+data.data.msgTypeName+'</div>'+
                    '<div class="pop_time">'+data.data.createTime+'</div>'+
                    '<div class="pop_text">'+data.data.content+'</div>'+
                    '<div class="poptime">首次提报时间:&nbsp;&nbsp;'+data.data.perCreateTime+'</div>'+
                    '<div class="pop_btn"><a href="personnel_y.html?personnelId='+personnelId+'">查看</a></div>'
              }else{
            	  selehtml+='<div class="pop_top"><img src="images/list/fail.png" alt="">'+data.data.msgTypeName+'</div>'+
            	  '<div class="pop_time">'+data.data.createTime+'</div>'+
            	  '<div class="pop_text">'+data.data.content+'</div>'+
            	  '<div class="poptime">首次提报时间：'+data.data.perCreateTime+'</div>'+
            	  '<div class="pop_feedback"><div class="feedback_title">管理员反馈：</div><div class="feedback">'+data.data.content+'</div>'+
            	  '</div>'+'<div class="pop_btn"><a href="personnel_y.html?personnelId='+personnelId+'">查看</a></div>'
              }
              
          
            if(data.data.msgTypeId=='4'){
            	 $('#success').html(selehtml)
            	 $('.pop_up').fadeOut(200);
                 $('.Mask').fadeIn(200);
                 $('.pop_up.'+'success').fadeIn(200);
            }else if(data.data.msgTypeId=='3'){
           	     $('#fail').html(selehtml)
          	     $('.pop_up').fadeOut(200);
                 $('.Mask').fadeIn(200);
                 $('.pop_up.'+'fail').fadeIn(200);
            }else if(data.data.msgTypeId=='5'){
	           	 $('#upload').html(selehtml)
	        	 $('.pop_up').fadeOut(200);
	             $('.Mask').fadeIn(200);
	             $('.pop_up.'+'upload').fadeIn(200);
            }else if(data.data.msgTypeId=='2'){
	             $('#end1').html(selehtml)
	         	 $('.pop_up').fadeOut(200);
	             $('.Mask').fadeIn(200);
	             $('.pop_up.'+'end').fadeIn(200);
            }else if(data.data.msgTypeId=='1'){
             	 $('#In_audit1').html(selehtml)
            	 $('.pop_up').fadeOut(200);
                 $('.Mask').fadeIn(200);
                 $('#In_audit1').fadeIn(200);
            }
            },
            error:function(jqXHR){
            }
        });
    };
    function btnhref(){
        window.location.href = "verify1_y.html?userId=3";
    }
</script>
</html>